importScripts("https://storage.googleapis.com/workbox-cdn/releases/7.3.0/workbox-sw.js"),workbox.core.setCacheNameDetails({prefix:"冰梦"}),workbox.core.skipWaiting(),workbox.core.clientsClaim(),workbox.precaching.precacheAndRoute([{revision:"915d7286921f3d1fc07e193c09c868eb",url:"./index.html"},{revision:"171e8e46c4dc9b4f15bfe8fb7451ec9f",url:"./css/index.css"},{revision:"86b45028f916ef7dd315441a2ee6a7a8",url:"./js/main.js"},{revision:"1301b5dfbb91a84b8e8f3f9becc9b0f0",url:"./404.html"},{revision:"0ac19d7bef5e9a5bfe13df7affdb2692",url:"./manifest.json"},{revision:"f13dc7d37e34d5a73a238afd006b8013",url:"./img/siteicon/favicon.ico"}],{directoryIndex:null}),workbox.precaching.cleanupOutdatedCaches(),workbox.googleAnalytics.initialize();const e={CACHE_NAME:"icemystCache",VERSION_CACHE_NAME:"icemystCacheTime",MAX_ACCESS_CACHE_TIME:864e3,CACHE_TIMEOUT:400,DAY:86400},t=()=>Math.floor(Date.now()/1e3),s=(t=30*e.DAY)=>[new workbox.expiration.ExpirationPlugin({maxEntries:1e3,maxAgeSeconds:t}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})];[{pattern:/^https:\/\/fonts\.googleapis\.com/,strategy:"StaleWhileRevalidate",cacheName:"google-fonts-stylesheets",plugins:[]},{pattern:/^https:\/\/fonts\.gstatic\.com/,strategy:"CacheFirst",cacheName:"google-fonts-webfonts"},{pattern:/^https:\/\/cdn\.jsdelivr\.net/,strategy:"CacheFirst",cacheName:"static-libs"}].forEach(({pattern:e,strategy:t,cacheName:a,plugins:c})=>{workbox.routing.registerRoute(e,new workbox.strategies[t]({cacheName:a,plugins:c||s()}))});class a{static createKey(e,t){return new Request(`https://${e}/${encodeURIComponent(t)}`)}static async cacheOperation(t,s,a){try{const c=await caches.open(e.VERSION_CACHE_NAME);switch(t){case"read":const e=await caches.match(s);return e?await e.text():null;case"write":await c.put(s,new Response(a));break;case"delete":await c.delete(s)}}catch(e){return null}}static async readTime(e){return this.cacheOperation("read",this.createKey("LOCALCACHE",e))}static async writeTime(e,t){return this.cacheOperation("write",this.createKey("LOCALCACHE",e),t)}static async updateAccess(e){return this.cacheOperation("write",this.createKey("ACCESS-CACHE",e),t())}static async checkAccess(s){const a=this.createKey("ACCESS-CACHE",s),c=await this.cacheOperation("read",a);return!!c&&(this.cacheOperation("delete",a),t()-c<e.MAX_ACCESS_CACHE_TIME)}}self.addEventListener("install",()=>self.skipWaiting());const c={html:{pattern:/\.html$/i,maxAge:e.DAY},pages:{pattern:/\/(categories|tags|about|archives|link)\/?$/i,maxAge:e.DAY}},r=[{sources:["//s2.loli.net"],target:"//images.weserv.nl/?url=s2.loli.net"},{sources:["//cdn.jsdelivr.net/gh","//jsd.onmicrosoft.cn/gh"],target:"//cdn.jsdmirror.cn/gh"}],n=/\.(js|css|jpg|jpeg|png|gif|webp|ico|svg|woff|woff2|ttf|eot|mp3|mp4)$/i;const o=[/google-analytics\.com\/collect/,/googletagmanager\.com/,/doubleclick\.net/];self.addEventListener("fetch",s=>{const i=s.request,l=function(e){let t=e.url;for(const{sources:s,target:a}of r){const c=s.find(e=>t.includes(e));if(c)return new Request(t.replace(c,a),{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer})}return null}(i),f=l||i;if(u=f.url,o.some(e=>e.test(u)))return void s.respondWith(new Response(null,{status:204}));var u;const h=function(e){if(n.test(e))return null;for(const t of Object.values(c))if(t.pattern.test(e))return t;return null}(f.url);h?s.respondWith(caches.match(f).then(s=>async function(s,c,r){const n=t(),o=s.url;if(a.updateAccess(o),c){const e=await a.readTime(o);if(e&&n-e<r.maxAge)return c}const i=async()=>{try{const t=await fetch(s);if(t.ok){await a.writeTime(o,n);const c=await caches.open(e.CACHE_NAME);await c.put(s,t.clone())}return t}catch(e){return c||new Response("网络不可用",{status:503,statusText:"Service Unavailable"})}};if(c){const t=new Promise(t=>setTimeout(()=>t(c),e.CACHE_TIMEOUT));return Promise.race([t,i()])}return i()}(f,s,h))):l&&s.respondWith(fetch(f))});