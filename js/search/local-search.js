class a{constructor({path:a="",unescape:t=!1,top_n_per_article:i=1}){this.path=a,this.unescape=t,this.top_n_per_article=i,this.isfetched=!1,this.datas=null}getIndexByWord(a,t,i=!1){const n=[],s=new Set;return i||(t=t.toLowerCase()),a.forEach(a=>{if(this.unescape){const t=document.createElement("div");t.innerText=a,a=t.innerHTML}const e=a.length;if(0===e)return;let o=0,l=-1;for(i||(a=a.toLowerCase());(l=t.indexOf(a,o))>-1;)n.push({position:l,word:a}),s.add(a),o=l+e}),n.sort((a,t)=>a.position!==t.position?a.position-t.position:t.word.length-a.word.length),[n,s]}mergeIntoSlice(a,t,i){let n=i[0],{position:s,word:e}=n;const o=[],l=new Set;for(;s+e.length<=t&&0!==i.length;){l.add(e),o.push({position:s,length:e.length});const a=s+e.length;for(i.shift();0!==i.length&&(n=i[0],s=n.position,e=n.word,a>s);)i.shift()}return{hits:o,start:a,end:t,count:l.size}}highlightKeyword(a,t){let i="",n=t.start;for(const{position:s,length:e}of t.hits)i+=a.substring(n,s),n=s+e,i+=`<mark class="search-keyword">${a.substr(s,e)}</mark>`;return i+=a.substring(n,t.end),i}getResultItems(a){const t=[];return this.datas.forEach(({title:i,content:n,url:s})=>{const[e,o]=this.getIndexByWord(a,i),[l,c]=this.getIndexByWord(a,n),r=new Set([...o,...c]).size,h=e.length+l.length;if(0===h)return;const g=[];0!==e.length&&g.push(this.mergeIntoSlice(0,i.length,e));let d=[];for(;0!==l.length;){const a=l[0],{position:t}=a;d.push(this.mergeIntoSlice(Math.max(0,t-20),Math.min(n.length,t+100),l))}d.sort((a,t)=>a.count!==t.count?t.count-a.count:a.hits.length!==t.hits.length?t.hits.length-a.hits.length:a.start-t.start);const u=parseInt(this.top_n_per_article,10);u>=0&&(d=d.slice(0,u));let p="";(s=new URL(s,location.origin)).searchParams.append("highlight",a.join(" ")),p+=0!==g.length?`<li class="local-search-hit-item"><a href="${s.href}"><span class="search-result-title">${this.highlightKeyword(i,g[0])}</span>`:`<li class="local-search-hit-item"><a href="${s.href}"><span class="search-result-title">${i}</span>`,d.forEach(a=>{p+=`<p class="search-result">${this.highlightKeyword(n,a)}...</p></a>`}),p+="</li>",t.push({item:p,id:t.length,hitCount:h,includedCount:r})}),t}fetchData(){const a=!this.path.endsWith("json");fetch(this.path).then(a=>a.text()).then(t=>{this.isfetched=!0,this.datas=a?[...(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("entry")].map(a=>({title:a.querySelector("title").textContent,content:a.querySelector("content").textContent,url:a.querySelector("url").textContent})):JSON.parse(t),this.datas=this.datas.filter(a=>a.title).map(a=>(a.title=a.title.trim(),a.content=a.content?a.content.trim().replace(/<[^>]+>/g,""):"",a.url=decodeURIComponent(a.url).replace(/\/{2,}/g,"/"),a)),window.dispatchEvent(new Event("search:loaded"))})}highlightText(a,t,i){const n=a.nodeValue;let s=t.start;const e=[];for(const{position:a,length:o}of t.hits){const t=document.createTextNode(n.substring(s,a));s=a+o;const l=document.createElement("mark");l.className=i,l.appendChild(document.createTextNode(n.substr(a,o))),e.push(t,l)}a.nodeValue=n.substring(s,t.end),e.forEach(t=>{a.parentNode.insertBefore(t,a)})}highlightSearchWords(a){const t=new URL(location.href).searchParams.get("highlight"),i=t?t.split(" "):[];if(!i.length||!a)return;const n=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,null),s=[];for(;n.nextNode();)n.currentNode.parentNode.matches("button, select, textarea, .mermaid")||s.push(n.currentNode);s.forEach(a=>{const[t]=this.getIndexByWord(i,a.nodeValue);if(!t.length)return;const n=this.mergeIntoSlice(0,a.nodeValue.length,t);this.highlightText(a,n,"search-keyword")})}}window.addEventListener("load",()=>{const{path:t,top_n_per_article:i,unescape:n,languages:s,pagination:e}=GLOBAL_CONFIG.localSearch,o=e&&e.enable,l=new a({path:t,top_n_per_article:i,unescape:n}),c=document.querySelector(".local-search-input input"),r=document.getElementById("local-search-stats"),h=document.getElementById("loading-status"),g=!t.endsWith("json");let d=0;const u=e.hitsPerPage||10;let p=[];o||(d=void 0,p=void 0);const m={get pagination(){return document.getElementById("local-search-pagination")},get paginationList(){return document.querySelector("#local-search-pagination .ais-Pagination-list")}},f=a=>{m.pagination.style.display=o&&a?"":"none"},P=(a,t)=>{const i=document.getElementById("local-search-results"),n=o?p.slice(d*u,(d+1)*u):t;if(o&&0===n.length&&p.length>0)return d=0,void P(a,t);const e=n.map((a,t)=>a.item.replace('<li class="local-search-hit-item">',`<li class="local-search-hit-item" value="${o?d*u+t+1:t+1}">`));i.innerHTML=`<ol class="search-result-list">${e.join("")}</ol>`;const l=s.hits_stats.replace(/\$\{hits}/,o?p.length:t.length);if(r.innerHTML=`<hr><div class="search-result-stats">${l}</div>`,o){w(d,Math.ceil(p.length/u),a)}f(t.length>0),window.pjax&&window.pjax.refresh(i)},w=(a,t,i)=>{if(t<=1)return m.pagination.style.display="none",void(m.paginationList.innerHTML="");m.pagination.style.display="block";const n=0===a,s=a===t-1,e=window.innerWidth<768?3:5;let o=Math.max(0,a-Math.floor(e/2));const l=Math.min(t-1,o+e-1);l-o+1<e&&(o=Math.max(0,l-e+1));let c="";t>e&&o>0&&(c+='\n        <li class="ais-Pagination-item ais-Pagination-item--page">\n          <a class="ais-Pagination-link" aria-label="Page 1" href="#" data-page="0">1</a>\n        </li>',o>1&&(c+='\n          <li class="ais-Pagination-item ais-Pagination-item--ellipsis">\n            <span class="ais-Pagination-link">...</span>\n          </li>'));for(let t=o;t<=l;t++){c+=t===a?`\n          <li class="ais-Pagination-item ais-Pagination-item--page ais-Pagination-item--selected">\n            <span class="ais-Pagination-link" aria-label="Page ${t+1}">${t+1}</span>\n          </li>`:`\n          <li class="ais-Pagination-item ais-Pagination-item--page">\n            <a class="ais-Pagination-link" aria-label="Page ${t+1}" href="#" data-page="${t}">${t+1}</a>\n          </li>`}t>e&&l<t-1&&(l<t-2&&(c+='\n          <li class="ais-Pagination-item ais-Pagination-item--ellipsis">\n            <span class="ais-Pagination-link">...</span>\n          </li>'),c+=`\n        <li class="ais-Pagination-item ais-Pagination-item--page">\n          <a class="ais-Pagination-link" aria-label="Page ${t}" href="#" data-page="${t-1}">${t}</a>\n        </li>`),t>1?m.paginationList.innerHTML=`\n            <li class="ais-Pagination-item ais-Pagination-item--previousPage ${n?"ais-Pagination-item--disabled":""}">\n              ${n?'<span class="ais-Pagination-link ais-Pagination-link--disabled" aria-label="Previous Page"><i class="fas fa-angle-left"></i></span>':`<a class="ais-Pagination-link" aria-label="Previous Page" href="#" data-page="${a-1}"><i class="fas fa-angle-left"></i></a>`}\n            </li>\n            ${c}\n            <li class="ais-Pagination-item ais-Pagination-item--nextPage ${s?"ais-Pagination-item--disabled":""}">\n              ${s?'<span class="ais-Pagination-link ais-Pagination-link--disabled" aria-label="Next Page"><i class="fas fa-angle-right"></i></span>':`<a class="ais-Pagination-link" aria-label="Next Page" href="#" data-page="${a+1}"><i class="fas fa-angle-right"></i></a>`}\n            </li>`:m.pagination.style.display="none"},b=()=>{if(!l.isfetched)return;let a=c.value.trim().toLowerCase();g&&(a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;")),""!==a&&(h.hidden=!1);const t=a.split(/[-\s]+/);let i=[];a.length>0&&(i=l.getResultItems(t)),1===t.length&&""===t[0]?(document.getElementById("local-search-results").textContent="",r.textContent="",f(!1),o&&(p=[],d=0)):0===i.length?(a=>{document.getElementById("local-search-results").textContent="";const t=document.createElement("div");t.className="search-result-stats",t.textContent=s.hits_empty.replace(/\$\{query}/,a),r.innerHTML=t.outerHTML,f(!1),o&&(p=[],d=0)})(a):(i.sort((a,t)=>a.includedCount!==t.includedCount?t.includedCount-a.includedCount:a.hitCount!==t.hitCount?t.hitCount-a.hitCount:t.id-a.id),o&&(p=i,d=0),P(a,i)),h.hidden=!0};let $=!1;const k=document.getElementById("search-mask"),v=document.querySelector("#local-search .search-dialog"),_=()=>{window.innerWidth<768&&v.style.setProperty("--search-height",window.innerHeight+"px")},x=()=>{btf.overflowPaddingR.add(),btf.animateIn(k,"to_show 0.5s"),btf.animateIn(v,"titleScale 0.5s"),setTimeout(()=>{c.focus()},300),$||(!l.isfetched&&l.fetchData(),c.addEventListener("input",b),$=!0),document.addEventListener("keydown",function a(t){"Escape"===t.code&&(y(),document.removeEventListener("keydown",a))}),_(),window.addEventListener("resize",_)},y=()=>{btf.overflowPaddingR.remove(),btf.animateOut(v,"search_close .5s"),btf.animateOut(k,"to_hide 0.5s"),window.removeEventListener("resize",_)},I=()=>{btf.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",x)};window.addEventListener("search:loaded",()=>{const a=document.getElementById("loading-database");a.nextElementSibling.style.visibility="visible",a.remove()}),I(),document.querySelector("#local-search .search-close-button").addEventListener("click",y),k.addEventListener("click",y),GLOBAL_CONFIG.localSearch.preload&&l.fetchData(),l.highlightSearchWords(document.getElementById("article-container")),o&&m.pagination.addEventListener("click",a=>{a.preventDefault();const t=a.target.closest("a[data-page]");if(t){const a=parseInt(t.dataset.page,10);!isNaN(a)&&p.length>0&&(d=a,P(c.value.trim().toLowerCase(),p))}}),f(!1),window.addEventListener("pjax:complete",()=>{!btf.isHidden(k)&&y(),l.highlightSearchWords(document.getElementById("article-container")),I()})});